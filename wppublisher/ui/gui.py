from PyQt5.QtWidgets import (QMainWindow, QFileDialog)

from wppublisher.ui import generated
from wppublisher.push import server
from wppublisher.initialize import install

'''
The qt gui class is generated by pyuic5
Due to it being a generated class, it is not edited directly.
Instead, this class wraps around it.
'''
class wp_gui(QMainWindow):
    def __init__(self):
        super().__init__()
        self.init_ui()

    def get_installation_variables(self):

        database_variables = {
            'hostname': self.ui.installation_database_hostname_text.text(),
            'username': self.ui.installation_database_password_text.text(),
            'password': self.ui.installation_database_username_text.text()
        }

        self.installation_variables = {
            'path': self.ui.installation_path_text.text(),
            'site_url': self.ui.installation_site_url_text.text(),
            'username': self.ui.installation_username_text.text(),
            'wordmove_config': self.ui.wordmove_checkbox.isChecked(),
            'database': database_variables
        }

    def set_installation_path(self):
        dialogue_title = 'Select the folder where you would like to install wordpress'
        folder_name = QFileDialog.getExistingDirectory(self, dialogue_title)
        installation_path = self.ui.installation_path_text
        installation_path.setText(folder_name)

    def start_install(self):
        self.get_installation_variables()
        installation = install.wordpress()
        installation.start(self.installation_variables)

    def start_publish(self):
        vps = server.digital_ocean()
        vps.initialize()

    def init_ui(self):
        self.ui = generated.Ui_MainWindow()
        self.ui.setupUi(self)

        # set connections up for buttons
        installation_path_selector = self.ui.installation_path_file_selector
        installation_path_selector.clicked.connect(self.set_installation_path)

        installation_start_button = self.ui.installation_start_button
        installation_start_button.clicked.connect(self.start_install)

        self.show()